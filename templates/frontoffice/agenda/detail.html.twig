{% extends 'frontoffice/_components/layout.html.twig' %}
{% block body %}

    <!-- IMAGE DU HAUT -->
    <div class="container-fluid px-0 shadow-lg mt-5" >
        <div class="row gx-0">
            <div class="col-12 col-lg-8 p-0 position-relative w-sm-100" style="">
                {% if article.cancelled %}
                    <div class="cancelled-overlay">
                        <p class="cancelled-text">ANNULÉ</p>
                    </div>
                {% elseif article.reported %}
                    <div class="cancelled-overlay">
                        <p class="cancelled-text">REPORTÉ</p>
                    </div>
                {% elseif article.full %}
                    <div class="full-overlay">
                        <p class="cancelled-text">COMPLET</p>
                    </div>
                {% endif %}
                {% set media = article.getMedia(18) %}
                {% set category = article.category %}
                {% do category.getDatas(locale) %}
                {% if media is not null %}
                    <img src="{{ url('ressources_image', {'width':'src','height':'src', 'media':media.media} ) }}" class="rounded-0 w-100 img-fluid"   alt="...">
                {% else %}
                    {% set mediaCategoryAgenda = category_agenda.getMedia(25) %}
                    {% if mediaCategoryAgenda is not null %}
                        <img src="{{ url('ressources_image', {'width':'src','height':'src', 'media':mediaCategoryAgenda.media} ) }}" class="d-block w-100" alt="...">
                    {% endif %}
                {% endif %}
            </div>
            <!-- BILLETTERIE AU DESSUS DE L'IMAGE -->
            <div class="col-12 col-lg-4" style="z-index: 600; border-left: #C8C8C8 solid 1px" >
                <div class="d-flex white text-uppercase align-items-center">
                    <div
                            class="p-3"
                            style="background-color:{{ article.category.themeBackColor }};color: {{ article.themeTextColor }};"
                    >
                        {{ category.title | upper }}
                    </div>

                    <div class="flex-grow-1 p-3" style="background-color: black;"><img class="pe-1" style="width: 1.2rem;" src="{{ asset(getSiteImagePath('MINI_BILLETTERIE.svg')) }}"> {{ article.style }}</div>
                </div>
                <div class="" >
                    <!-- Titre -->
                    <div class="p-5">
                        <h1 class="fw-bold mb-0">{% if article.eventName is not empty %}{{ article.eventName }} :{% endif%} {{ article.titleByLanguage }}</h1>
                        <h2 class="">{{ article.subtitle }}</h2>
                        <hr>
                        <p class="h3 fw-bold mt-5">{{ formatCustomDate(article.dateEvent) }}</p>
                        {% if article.datetimeEventOpening is not empty and article.datetimeEventOpening is not null %}
                            <p class="fs-5">{{ article.datetimeEventOpening | date("H:i") }} </p>
                        {% endif %}
                        <!-- EVENT TERMINE -->
                        {% if article.dateEvent <  current_date %}
                            <p class="text-bg-danger p-3 text-center fs-2">Cet évènement est terminé.</p>
                        {% else %}

                            <!-- EVENT ANNULÉ -->
                            {% if article.cancelled %}
                            <div>
                                <p class="text-bg-danger p-3 text-center fs-2">Cet évènement est annulé.</p>
                                {% if article.refund %}
                                    <div class="d-grid">
                                        <a class="btn btn-read-card " href="{{ article.refund }}">Lien de remboursement</a>
                                    </div>
                                {% endif %}
                            </div>
                            {% endif %}

                            <!-- EVENT REPORTE -->
                            {% if article.reported %}
                                <div>
                                    <p class="text-bg-danger p-3 text-center fs-2">Cet évènement est reporté.</p>
                                    {% if article.cancelledOrReportedDescription %}
                                        <div class="tfs-4">
                                            {{ article.cancelledOrReportedDescription }}
                                        </div>
                                    {% endif %}

                                </div>
                            {% endif %}

                            <!-- EVENT COMPLET -->
                            {% if article.full %}
                            <div>
                                <p class="text-bg-danger p-3 text-center fs-2">Cet évènement est complet.</p>
                            </div>
                            {% endif %}
                        {% endif %}

                        <!-- Tarifs -->
                        {% if article.dateEvent >  current_date %}

                        <div class="container-fluid">

                            {% if article.price is not empty and article.price is not null %}
                            <div class="row mt-3">
                                <div class="col btn-rate-card"> <a class="text-decoration-none" href="{{ article.ticketingLink }}">Tarif plein : {{ article.price }}</a></div>

                                {% if article.subscriberPrice %}
                                    <div class="col btn-rate-card mx-2"><a class="text-decoration-none" href="{{ article.ticketingLink }}">Tarif abo : {{ article.subscriberPrice }}</a></div>
                                {% endif %}

                                {%  if article.reducedPrice %}
                                    <div class="col btn-rate-card"><a class="text-decoration-none" href="{{ article.ticketingLink }}">Tarif réduit : {{ article.reducedPrice }}</a></div>
                                {% endif %}
                            </div>
                            {% endif %}

                        </div>
                        {% endif %}

                        <!-- Cartes Lunes -->
                        <div class="row gx-0 pt-5">
                            <div class="col text-center">

                                <a class="text-decoration-none" href="https://billetterie.lalune.net/abonnements/165251527696b7/renouvellement">
                                    <img class="rounded rounded-2" style="max-height: 50px" src="{{ asset(getSiteImagePath('abonnement.png')) }}">
                                    <div style="font-size: 14px">
                                        Profitez du tarif abonné<br>
                                        <b>
                                            avec la carte lune
                                        </b>
                                    </div>

                                </a>
                            </div>
                            {% if article.culturePassLink %}
                            <div class="col text-center">
                                <a class="text-decoration-none" href="{{ article.culturePassLink }}">
                                    <img style="max-height: 50px" src="{{ asset(getSiteImagePath('LUNE_PASS_CULTURE.svg')) }}">
                                    <div style="font-size: 14px">
                                        <b>Dispo sur le Pass Culture,</b><br>
                                        pour les 15-18 ans,<br>
                                        ou en offre collective
                                    </div>
                                </a>
                            </div>
                            {% endif %}
                        </div>
                        <hr>
                        <div class="pt-3">
                            {% if article.facebookEventLuneLink is not empty and article.facebookEventLuneLink is not null %}
                                <p class="fs-5"><a class="btn-read-card text-decoration-none" href="{{ article.facebookEventLuneLink }}">Évènement Facebook</a></p>
                            {% endif %}
                            {% if article.organizer is not empty and article.organizer is not null %}
                                <p style="" class="fs-5">Organisateur : {{ article.organizer }}</p>
                            {% endif %}
                            {% if article.placement is not empty and article.placement is not null %}
                                <p style="">{{ article.placement }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr class="my-0">
    <!-- RECAPITULATIF -->
    {% if (article.facebookEventLuneLink is not empty and article.facebookEventLuneLink is not null) or (article.organizer is not empty and article.organizer is not null) or (article.placement is not empty and article.placement is not null) or (article.datetimeEventOpening is not empty and article.datetimeEventOpening is not null)  %}
{#        <div class="container-fluid px-0">#}
{#            <div class=" text-center d-flex justify-content-around text-uppercase py-2"  style="background-color:{{ article.category.themeBackColor }};color: {{ article.themeTextColor }};">#}
{#                {% if article.facebookEventLuneLink is not empty and article.facebookEventLuneLink is not null %}#}
{#                    <p style="display: inline; margin: 0;"><a class="text-decoration-none" style="color: {{ article.themeTextColor }} !important" href="{{ article.facebookEventLuneLink }}">Évènement Facebook</a></p>#}
{#                {% endif %}#}
{#                {% if article.organizer is not empty and article.organizer is not null %}#}
{#                    <p style="display: inline; margin: 0;">Organisateur : {{ article.organizer }}</p>#}
{#                {% endif %}#}
{#                <!-- <p style="display: inline; margin: 0;">Lieu</p>-->#}
{#                {% if article.placement is not empty and article.placement is not null %}#}
{#                    <p style="display: inline; margin: 0;">{{ article.placement }}</p>#}
{#                {% endif %}#}
{#                {% if article.datetimeEventOpening is not empty and article.datetimeEventOpening is not null %}#}
{#                    <p style="display: inline; margin: 0;">Ouverture des portes : {{ article.datetimeEventOpening | date("H:i") }} </p>#}
{#                {% endif %}#}

{#            </div>#}
{#        </div>#}
{#        <hr class="my-0">#}
    {% endif %}
    <!-- DETAIL ARTICLE -->
    <div class="container-fluid">
        <div class="p-2 p-lg-5 row">
            <!-- CONTENU PARTIE GAUCHE-->
            <div class="col-lg-8 col-md-12">
                <!-- NOM GROUPE / STYLE / HORAIRE -->
                <div class="row pb-2 align-items-end">
                    <div class="col-lg-6 col-md-12">
                        <div class="fs-1 lh-1">{{ article.titleByLanguage }}</div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="fs-1 lh-1 d-flex align-items-center">{{ article.typeMusic}}  {% if article.origin != "" %} | {{ article.origin }}{% endif %}</div>
                    </div>
                    <div class="col-lg-2 col-md-6 d-flex justify-content-end">
                        {% if article.datetimeEvent is not null and article.datetimeEvent  is not empty %}
                            <div class="fs-1 lh-1">{{ article.datetimeEvent| date('H:i') }}</div>
                        {% endif %}
                    </div>
                </div>
                <!-- RESUME ARTISTE -->
                <div class="fs-5 py-3" style="line-height: 1.3">
                    {{ article.description | raw }}
                </div>
                <!-- IMAGE ARTISTE -->
                {% set media4 = article.getMedia(12) %}
                <!-- DESCRIPTION ARTISTE -->
                <div class="fs-5 py-3" style="line-height: 1.3">
                    {{ article.content | raw }}
                </div>
                <!-- VIDEO ARTISTE -->
                {% if article.youtubeLink %}
                    <div class="video-container">
                        <iframe src="{{ article.youtubeLink }}" allowfullscreen></iframe>
                    </div>
                {% endif %}
                <!-- PLUS D'INFOS SUR L'ARTISTE -->
                {% if article.soundcloudLink or article.soundcloudSecondLink or article.soundcloudThirdLink %}
                <div class="pt-5">
                    {% if article.soundcloudLink is not null and article.soundcloudLink is not empty %}
                        {{ article.soundcloudLink | raw }}
                    {% endif %}

                    {% if article.soundcloudSecondLink is not null and article.soundcloudSecondLink is not empty %}
                        {{ article.soundcloudSecondLink | raw }}
                    {% endif %}
                    {% if article.soundcloudThirdLink is not null and article.soundcloudThirdLink is not empty %}
                        {{ article.soundcloudThirdLink | raw }}
                    {% endif %}
                </div>
                {% endif %}
                <div class="row py-5">
                    <div class="col-lg-12 col-md-12 row">
                        <div class="mb-3 col-lg-12 col-md-12">
                            {% if not article.getFiles is empty %}
                                <div class="row ">
                                    {% set filesArray = article.getFiles() %}
                                    {% set arrayLength = filesArray|length %}
                                    {% if arrayLength > 1 %}
                                        <div class="d-flex">Fichiers : &nbsp;
                                            {% for file in article.getFiles() %}
                                                {% set url_file = '/assets/images/' ~ file.media %}
                                                <div class="d-inline">
                                                    <a class="btn-read-card" href="{{ url_file }}" role="button">{{ file.legend }}</a>
                                                </div>
                                                &nbsp;
                                            {% endfor %}
                                        </div>
                                    {% elseif arrayLength == 1 %}
                                        <div>
                                            Fichier :
                                                {% for file in article.getFiles() %}
                                                    {% set url_file = '/assets/images/' ~ file.media %}
                                                        <a class="btn-read-card" href="{{ url_file }}" role="button">{{ file.legend }}</a>
                                                {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-12 col-lg-4  text-center mt-3">
                            {% if article.instagramLink != '' or article.twitterLink != '' or article.facebookLink != '' or article.siteInternet != ''  %}
                                <div class="fs-4">Plus d'infos sur l'artiste</div>
                            {% endif %}
                        </div>
                        <div class="col-12 col-lg-4 text-center text-lg-start">
                            <!-- MEDIAS SOCIAUX -->
                            <div class="row text-center">
                                {% if article.instagramLink != '' %}
                                    <div class="col text-center">
                                        <a href="{{ article.instagramLink }}"><img class="mh-45"  src="{{ asset(getSiteImagePath('PICTURE.svg')) }}"></a>
                                    </div>
                                {% endif %}
                                {% if article.twitterLink != '' %}
                                    <div class="col">
                                        <a href="{{ article.twitterLink }}"><img class="mh-45" src="{{ asset(getSiteImagePath('TWITTER.svg')) }}"></a>
                                    </div>
                                {% endif %}
                                {% if article.facebookLink != '' %}
                                    <div class="col">
                                        <a href="{{ article.facebookLink }}"><img class="mh-45" src="{{ asset(getSiteImagePath('FACEBOOK.svg')) }}"></a>
                                    </div>
                                {% endif %}
                                {% if article.siteInternet != '' %}
                                    <div class="col">
                                        <a href="{{ article.siteInternet }}"><img class="mh-45" src="{{ asset(getSiteImagePath('INTERNET.svg')) }}"></a>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- LIENS ET INFOS PRATIQUES (PARTIE DROITE) -->
            <div class="col-lg-4 col-md-12 d-flex align-content-end justify-content-center flex-wrap text-md-center text-lg-start">

                <div class="p-5 d-none d-lg-block">
                    <!-- CARTE LUNE -->
                    <div class="py-3">
                        <a rel="nofollow" href="https://billetterie.lalune.net/abonnements/165390773e0ce5/renouvellement">
                            <img class="img-fluid" style="max-width: 313px" src="{{ asset(getSiteImagePath('abonnement.png')) }}">
                        </a>
                        <div class="fs-5">
                            Concerts Gratuits Abonnés & Réductions
                        </div>
                        <div class="fs-5 fw-bold">
                            Abonnez-vous !
                        </div>
                    </div>
                    <div class="py-5 h3">
                        <a class="text-decoration-none" href="https://pass.culture.fr/">
                        <img style="max-height: 90px" src="{{ asset(getSiteImagePath('PASS_CULTURE_BIG.svg')) }}">
                            <div class="fs-5">
                                <b>Dispo sur le Pass Culture,</b><br>
                                pour les 15-18 ans,<br>
                                ou en offre collective
                            </div>
                        </a>
                    </div>
                    <div class="py-5">
                        <a class="text-decoration-none" href="{{ path('fo_infos_index') }}">
                            <img style="max-height: 150px" src="{{ asset(getSiteImagePath('infos.png')) }}">
                        </a>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <!-- DEUXIEME PARTIE -->
    {% for child in children %}
        {% do child.getDatas(locale) %}
    <div class="bg-grey container-fluid">
        <div class="p-2 p-lg-5">
            <div class="row">
                <div class="col-lg-8 col-md-12">
                    <!-- NOM GROUPE / STYLE / HORAIRE -->
                    <div class="row py-3 align-items-end">
                        <div class="col-lg-6 col-md-12">
                            <h1 class="fs-1">{{ child.titleByLanguage }}</h1>
                        </div>
                        <div class="col-lg-4 col-md-8"  >
                            <div class="h4 d-flex align-items-center">{{ child.typeMusic}}  {% if child.origin != "" %} | {{ child.origin }}{% endif %}</div>
                        </div>
                        <div class="col-lg-2 col-md-4 d-flex justify-content-end">
                            <div class="fs-2">{{ child.datetimeEvent | date('H:i') }}</div>
                        </div>
                    </div>
                    <!-- DESCRIPTION ARTISTE -->
                    <div class="fs-5">
                        {{ child.description | raw }}
                    </div>
                    <!-- Image Artiste Ou vidéos artistes-->
                    {% set media3 = child.getMedia(33) %}
                    <div class="pt-3">

                        {% if child.youtubeLink is not empty and child.youtubeLink is not null %}
                            <div class="embed-responsive embed-responsive-16by9">
                                <div class="video-container">
                                    <iframe src="{{ child.youtubeLink }}" allowfullscreen></iframe>
                                </div>
                            </div>
                        {% endif %}
                        {% if child.youtubeSecondLink is not empty and child.youtubeSecondLink is not null %}
                            <div class="embed-responsive embed-responsive-16by9">
                                <div class="video-container">
                                    <iframe src="{{ child.youtubeLink }}" allowfullscreen></iframe>
                                </div>                            </div>
                        {% endif %}
                        {% if media3 is not null and child.youtubeSecondLink is empty  and child.youtubeLink is empty %}
                            {% set url = '/assets/images/' ~ media3.media  %}
                            <img src="{{ asset((url)) }}" class="card-img-top rounded-0" alt="...">
                        {% endif %}
                    </div>
                    <!-- CONTENT ARTISTE -->
                    <div class="fs-5 py-3">
                        {{ child.content | raw }}
                    </div>
                    <!-- PLUS D'INFOS SUR L'ARTISTE -->
                    <!-- PLUS D'INFOS SUR L'ARTISTE -->
                    {% if child.soundcloudLink or child.soundcloudSecondLink or child.soundcloudThirdLink %}
                        <div class="pt-5">
                            {% if child.soundcloudLink is not null and child.soundcloudLink is not empty %}
                                {{ child.soundcloudLink | raw }}
                            {% endif %}

                            {% if child.soundcloudSecondLink is not null and child.soundcloudSecondLink is not empty %}
                                {{ child.soundcloudSecondLink | raw }}
                            {% endif %}
                            {% if child.soundcloudThirdLink is not null and child.soundcloudThirdLink is not empty %}
                                {{ child.soundcloudThirdLink | raw }}
                            {% endif %}
                        </div>
                    {% endif %}
                    <div class="row">
                        <div class="col-lg-8 offset-lg-4 col-md-12 py-5">
                            <div class="row">
                                <div class="col-12 col-lg-6 d-flex align-items-end">
                                    {% if child.instagramLink != '' or child.twitterLink != '' or child.facebookLink != '' or child.siteInternet != ''  %}
                                        <div class="fs-4 text-center text-lg-start">Plus d'infos sur l'artiste</div>
                                    {% endif %}
                                </div>
                                <div class="col-12 col-lg-6">
                                    <!-- MEDIAS SOCIAUX -->
                                    <div class="row text-center">
                                        {% if child.instagramLink != '' %}
                                            <div class="col">
                                                <a href="{{ child.instagramLink }}"><img class="mh-45" src="{{ asset(getSiteImagePath('PICTURE.svg')) }}"></a>
                                            </div>
                                        {% endif %}
                                        {% if child.twitterLink != '' %}
                                            <div class="col">
                                                <a href="{{ child.twitterLink }}"><img class="mh-45" src="{{ asset(getSiteImagePath('TWITTER.svg')) }}"></a>
                                            </div>
                                        {% endif %}
                                        {% if child.facebookLink != '' %}
                                            <div class="col">
                                                <a href="{{ child.facebookLink }}"><img class="mh-45" src="{{ asset(getSiteImagePath('FACEBOOK.svg')) }}"></a>
                                            </div>
                                        {% endif %}
                                        {% if child.siteInternet != '' %}
                                            <div class="col">
                                                <a href="{{ child.siteInternet }}"><img class="mh-45" src="{{ asset(getSiteImagePath('INTERNET.svg')) }}"></a>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-12 d-flex align-content-end justify-content-center text-md-center text-lg-start flex-wrap">
{#                    <div class="p-5 d-none d-lg-block">#}
{#                        <div class="py-5" style="max-height: 140px; max-width: 266px;min-width: 265px">#}
{#                            <a class="text-decoration-none" href="{{ path('fo_infos_index') }}">#}
{#                                <img src="{{ asset(getSiteImagePath('INFOS_PRATIQUES.svg')) }}">#}
{#                            </a>#}
{#                        </div>#}
{#                    </div>#}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    <!-- A DECOUVRIR -->
    <hr class="my-0">
    <div class="p-lg-5 container-fluid">
        <h1 class="pb-lg-5 pt-3 pt-lg-0">
            à découvrir >> >> >>
        </h1>
        <div class="row">

            {#Compteur pour afficher le nombre souhaité dans la vue #}
            {% set count = 0 %}
            {% for event in events_agenda %}
                {% if getDatetimeEvent(event.dateEvent, event.datetimeEvent) > current_date and count < 4 %}
                    {% if article.id != event.id %}
                        {% set media = event.getMedia(1) %}
                        {% set CategoryTitle = event.category.title|replace({' ': '-'})|lower %}
                        <div class="custom-col-xxl-3 col-lg-4 col-md-12 py-3 pb-lg-5 px-lg-3 category-{{ CategoryTitle }} category-tous-les-evenements {% if count == 3 %}d-none show-xxl{% endif %}">
                            <!-- Card-Actu -->
                            {% include 'frontoffice/_components/card.html.twig' with {'event': event, 'agenda': true, 'showButton': false, 'actu': false, 'billetterie': true, 'soutiens': false, 'actions' : false } %}
                        </div>
                        {% set count = count + 1 %}
                    {% endif %}
                {% endif %}
            {% endfor %}
        </div>
    </div>
{% endblock %}